{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/TankController.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","rb","RigidBody","spawnBullet","Node","BulletPrefabs","Prefab","speedBullet","default","serializable","tankSpeed","_Ammunition","_playerHealth","onLoad","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","node","getBulletDirection","bind","bulletPos","convertToWorldSpaceAR","position","parent","convertToNodeSpaceAR","event","keyCode","macro","KEY","a","moveLeft","d","moveRight","w","moveUp","s","moveDown","space","undefined","instance","emit","_shootDirec","angle","linearVelocity","v2","onBeginContact","contact","selfCollider","otherCollider","tag","destroy","playerDead","playerGetDame","active","group","tween","to","color","Color","start"],"mappings":"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","file":"TankController.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["const Emitter = require(\"EventsListener\")\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        rb: cc.RigidBody,\n        spawnBullet: cc.Node,\n        BulletPrefabs: cc.Prefab,\n        speedBullet:{\n            default:200,\n            serializable:false,\n        },\n        tankSpeed: {\n            default:300,\n            serializable:false,\n        },\n        _Ammunition:{\n            default:10,\n            serializable:false,\n        },\n        _playerHealth:{\n            default:100,\n            serializable:false,\n        },\n    },\n\n    onLoad: function () {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n        this.node.on(\"rotation-changed\", this.getBulletDirection.bind(this))\n    },\n\n    getBulletDirection(){\n        this.bulletPos = this.node.convertToWorldSpaceAR(this.spawnBullet.position);\n        this.bulletPos = this.node.parent.convertToNodeSpaceAR(this.bulletPos);\n    },\n\n    onKeyDown: function (event) {   \n        switch(event.keyCode) {\n            case cc.macro.KEY.a:\n                this.moveLeft()\n                break;\n            case cc.macro.KEY.d:\n                this.moveRight()\n                break;\n            case cc.macro.KEY.w:\n                this.moveUp()\n                break;\n            case cc.macro.KEY.s:\n                this.moveDown()\n                break;\n        }\n        \n        switch(event.keyCode) {\n            case cc.macro.KEY.space:\n                if ( this._Ammunition > 0){\n                    if (this.bulletPos != undefined){\n                        this.getBulletDirection()\n                        this._Ammunition -=1\n                        Emitter.instance.emit(\"SpawnBullet\", this.bulletPos, this._shootDirec, this.BulletPrefabs, this.node.angle)\n                        Emitter.instance.emit(\"HUDcontroll\", this._playerHealth, this._Ammunition)\n                    }   \n                }\n               \n            break;\n        }\n    },\n\n    onKeyUp(event){\n        switch(event.keyCode) {\n            case cc.macro.KEY.w:\n            case cc.macro.KEY.s:\n            case cc.macro.KEY.a:\n            case cc.macro.KEY.d:\n                this.rb.linearVelocity = new cc.v2(0, 0)\n                break;\n        }\n    },\n\n    moveUp(){\n        this.node.angle = 0\n        this._shootDirec = new cc.v2(0,this.speedBullet)\n        this.rb.linearVelocity = new cc.v2(0, this.tankSpeed)\n        \n    },\n\n    moveDown(){\n        this.node.angle = 180\n        this._shootDirec = new cc.v2(0,-this.speedBullet)\n        this.rb.linearVelocity = new cc.v2(0, -this.tankSpeed)\n    },\n\n    moveLeft(){\n        this.node.angle = 90\n        this._shootDirec = new cc.v2(-this.speedBullet,0)\n        this.rb.linearVelocity = new cc.v2(-this.tankSpeed, 0)\n    },\n\n    moveRight(){\n        this.node.angle = 270\n        this._shootDirec = new cc.v2(this.speedBullet,0)\n        this.rb.linearVelocity = new cc.v2(this.tankSpeed, 0)\n       \n    },\n\n    onBeginContact(contact, selfCollider, otherCollider){\n        if (otherCollider.tag === 5){\n            this._Ammunition += 5\n            Emitter.instance.emit(\"HUDcontroll\", this._playerHealth, this._Ammunition)\n            otherCollider.node.destroy()\n        }\n\n        if (otherCollider.tag === 3){\n            this._playerHealth -= 30\n            Emitter.instance.emit(\"HUDcontroll\", this._playerHealth, this._Ammunition)\n            if (this._playerHealth <= 0){\n                this.playerDead()\n            }\n            else{\n                this.playerGetDame()\n            }\n        }\n\n        if (otherCollider.tag === 6){\n            this._playerHealth -= 10\n            Emitter.instance.emit(\"HUDcontroll\", this._playerHealth, this._Ammunition)\n            if (this._playerHealth <= 0){\n                this.playerDead()\n            }\n            else{\n                this.playerGetDame()\n            }\n        }\n\n        if (otherCollider.tag === 10){\n            this._Ammunition = 0\n            Emitter.instance.emit(\"Win\")\n            this.node.active = false;\n        }\n\n        if (otherCollider.node.group ===\"Bullet\"){\n            otherCollider.node.destroy()\n        }\n    },\n\n    playerDead(){\n        this.node.active = false\n        this._Ammunition = 0\n        Emitter.instance.emit(\"Lose\")\n    },\n\n    playerGetDame(){\n        if(this._playerHealth > 0){\n            cc.tween(this.node)\n            .to(0.2,{color: new cc.Color(255,0,0,255)})\n            .to(0.2,{color: new cc.Color(255,255,255,255)})\n            .to(0.2,{color: new cc.Color(255,0,0,255)})\n            .to(0.2,{color: new cc.Color(255,255,255,255)})\n            .to(0.2,{color: new cc.Color(255,0,0,255)})\n            .to(0.2,{color: new cc.Color(255,255,255,255)})\n            .start()\n\n        }\n        else if(this._playerHealth <= 0){\n            this.playerDead()\n        }\n    }\n\n});\n"]}