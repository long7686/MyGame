{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/EnemiesTank.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","barrel","Node","_enemyHealth","default","serializable","_shootCountTime","_target","_angleD","enemyBullet","Prefab","bulletSpawnPos","bulletPos","start","instance","registerEvent","lookAtPlayer","bind","on","getBulletDirection","player","v2","position","x","node","y","angle","Math","atan2","misc","radiansToDegrees","shootPlayer","convertToWorldSpaceAR","parent","convertToNodeSpaceAR","_isDead","emit","onBeginContact","contact","selfCollider","otherCollider","tag","enemyDead","group","destroy","active","effect","instantiate","deadEffect","addChild","scale","tween","to","opacity","call"],"mappings":"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","file":"EnemiesTank.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["const Emitter = require(\"EventsListener\")\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        barrel: cc.Node,\n        _enemyHealth: {\n            default: 60,\n            serializable:false,\n        },\n        _shootCountTime:{\n            default: 60,\n            serializable:false,\n        },\n        _target: null,\n        _angleD: null,\n        enemyBullet: cc.Prefab,\n        bulletSpawnPos: cc.Node,\n        bulletPos: null,\n        _angleD: null,\n        deadEffect: cc.Prefab,\n        _isDead: false,\n    },\n\n    start () {\n        Emitter.instance.registerEvent(\"playerGetIn\", this.lookAtPlayer.bind(this))  \n        this.barrel.on(\"rotation-changed\", this.getBulletDirection.bind(this))\n        \n    },\n\n    lookAtPlayer(player){\n        this._shootCountTime += 1\n        this._target = cc.v2(player.position.x - this.node.position.x, player.position.y - this.node.position.y)\n        let angle = Math.atan2(this._target .y, this._target.x);\n        this._angleD = cc.misc.radiansToDegrees(angle) + 90\n        this.barrel.angle = this._angleD;\n        if(this._shootCountTime >= 120){\n            this.shootPlayer()\n            this._shootCountTime = 0\n        }\n    },\n\n    getBulletDirection(){\n        this.bulletPos = this.barrel.convertToWorldSpaceAR(this.bulletSpawnPos.position);\n        this.bulletPos = this.node.parent.convertToNodeSpaceAR(this.bulletPos);\n    },\n\n    shootPlayer(){\n        if(!this._isDead){\n            Emitter.instance.emit('SpawnBullet', this.bulletPos, this._target,  this.enemyBullet, this._angleD +180 )\n        }\n    },\n\n    onBeginContact(contact, selfCollider, otherCollider){ \n        if (otherCollider.tag == 4){\n            if (this._enemyHealth > 0){\n                this._enemyHealth -= 10\n                Emitter.instance.emit(\"getDamge\", this.node)\n            }\n            if (this._enemyHealth <= 0){\n                \n                this.enemyDead()\n            }\n        }\n        if (otherCollider.node.group ===\"Bullet\"){\n            otherCollider.node.destroy()\n        }\n    },\n\n    enemyDead(){\n        this.node.active = false;\n        this._isDead = true\n        let effect = cc.instantiate(this.deadEffect)\n        this.node.parent.addChild(effect)\n        effect.position = this.node.position\n        effect.scale = 0\n        cc.tween(effect)\n            .to(0.2,{scale:0.5})\n            .to(0.5,{opacity: 0})\n            .call(() => effect.destroy())\n            .start()  \n        \n    }\n});\n"]}